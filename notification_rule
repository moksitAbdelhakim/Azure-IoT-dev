{
 "id" : "notification_rule01",
 "sql": "SELECT avg(Temperature) AS avg_temp, avg(Humidity) AS avg_hum FROM EdgexStream GROUP BY TUMBLINGWINDOW(ss, 60) HAVING avg_temp > 34 OR avg_hum > 34",
 "actions": [
 {
  "rest" : {
    "url" : "http://localhost:59860/api/v2/notification"
    "method": "post",
    "dataTemplate": "
      {\"apiVersion\": \"v2\", \"category\" : \ "Temperature, Humidity\", \"content\": \"The average temperature is {{.avg_temp}} and the average humidity is {{.avg_hum}} %.\", \"contentType\": \"text/plain\", \"description\": \"Alert from edgex rules engine\", \"labels\": \"Alert\", \"sender\": \"edgex rules engine\", \"severity\": \"CRITICAL\", \"status\": \"NEW\", \"type\": \"rulel\"}"
  }
 }]
}

%%%%%%%%%%%%%%%%%%%%%%%%%%% Subscription %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
{
  "apiVersion": "v2",
  "requestId": "7a1707f0-166f-4c4b-bc9d-1d54c74e0137",
  "subscription": {
    "name": "SystemManagementNotification",
    "description": "This subscription defines the critical notification which will be sent by system management.",
    "channels": [
      {
        "type": "EMAIL",
        "addresses": [
          "someone@example.com"
        ]
      }
    ],
    "categories": [
      {
        "type": "SW_HEALTH"
      }
    ],
    "labels": [
      "edgex-support-notifications"
    ],
    "receiver": "SystemManagementReceiver",
    "resendLimit": 5,
    "resendInterval": "10s"
  }
}


curl -X POST http://localhost:59860/api/v2/subscription -H 'Content-Type: application/json' -d '{ "apiVersion": "v2", "name": "TempHumidityAlerts", "description": "A subscription alerts for temperature and humidity", "receiver": "Abdelhakim Moksit", "channels": [ { "type": "EMAIL", "emailAddresses": ["moksit.abdelhakim@gmail.com"] } ], "categories": ["Temperature", "Humidity"], "severityLevels": ["CRITICAL"] }'
{
  "apiVersion": "v2",
  "name": "TempHumidityAlerts",
  "description": "A subscription alerts for temperature and humidity",
  "receiver": "Abdelhakim Moksit",
  "channels": [
    {
      "type": "EMAIL",
      "emailAddresses": [
        "abdlhakimoksit@gmail.com"
      ]
    }
  ],
  "categories": [
    "Temperature",
    "Humidity"
  ],
  "severityLevels": [
    "CRITICAL"
  ]
}
